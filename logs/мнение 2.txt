–ü—Ä–∏–≤–µ—Ç! –û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å, —ç—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å InteractiveViewer, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –æ–ø—ã—Ç–æ–º. –í–∞—à–∞ —Ç–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å —É–ø—Ä–∞–≤–ª—è—Ç—å –∑—É–º–æ–º —Å –ø–æ–º–æ—â—å—é –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (currentScale), –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º–∏.

–†–µ—à–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–∏—Å—Ç–µ–º–µ, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –¥–∏–∞–ø–∞–∑–æ–Ω –∑—É–º–∞ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º.

–í–æ—Ç –ø–æ—à–∞–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∑—É–º–∞:

1. –û—Ç–∫–∞–∂–∏—Ç–µ—Å—å –æ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —É—Ä–æ–≤–Ω–µ–π –∑—É–º–∞
–ü–µ—Ä–µ—Å—Ç–∞–Ω—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å currentScale –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π –∑—É–º–∞. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ relativeZoom (currentScale / minScale), –∫–∞–∫ –≤—ã –∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–ª–∏, –Ω–æ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–∞.

–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —É—Ä–æ–≤–Ω–µ–π –∑—É–º–∞: –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø–æ—Ä–æ–≥–∏ –∫–∞–∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã. –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –∏—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –æ–Ω–∏ –≤—ã–≥–ª—è–¥–µ–ª–∏ —Ö–æ—Ä–æ—à–æ.

Dart

const double LEVEL2_THRESHOLD = 4.0;  // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 2 –ø—Ä–∏ 4x —É–≤–µ–ª–∏—á–µ–Ω–∏–∏
const double LEVEL3_THRESHOLD = 12.0; // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 3 –ø—Ä–∏ 12x —É–≤–µ–ª–∏—á–µ–Ω–∏–∏
2. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –∑—É–º–∞
–°–∞–º–∞—è –±–æ–ª—å—à–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –∑—É–º–∞ –Ω–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Ç–∞–π–º–ª–∞–π–Ω–∞—Ö. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –≤–∞—à maxScale —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –û–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –∫ minScale.

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ: –ó–∞–¥–∞–π—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –≤–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –≤–∏–¥–æ–º.

Dart

const double MAX_RELATIVE_ZOOM = 25.0; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤ 25 —Ä–∞–∑
–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç minScale –∏ maxScale:

Dart

// –≠—Ç–æ –≤—ã —É–∂–µ –¥–µ–ª–∞–µ—Ç–µ: minScale, —á—Ç–æ–±—ã –≤—Å—è –ª–∏–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–º–µ—Å—Ç–∏–ª–∞—Å—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ
double minScale = screenWidth / timelineWidth;

// –ê –≤–æ—Ç –∏ –∫–ª—é—á –∫ —Ä–µ—à–µ–Ω–∏—é: maxScale –¥–æ–ª–∂–µ–Ω –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç minScale
double maxScale = minScale * MAX_RELATIVE_ZOOM;
–¢–µ–ø–µ—Ä—å, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –¥–ª–∏–Ω–Ω—ã–π —É –≤–∞—Å —Ç–∞–π–º–ª–∞–π–Ω, —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è –∑—É–º–∞ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, 25x).

3. –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –≤ 10px –¥–ª—è –Ω–æ–¥–∞
–í–∞—à–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–æ–¥—ã –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –±—ã–ª–∏ –≤–∏–¥–Ω—ã –∫–∞–∫ 10px, ‚Äî —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ maxScale. –ï–≥–æ –Ω—É–∂–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏—Ç—å —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º.

–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π maxScale –¥–ª—è 10px:

Dart

// nodeDiameter ‚Äî —ç—Ç–æ "—Ä–µ–∞–ª—å–Ω—ã–π" —Ä–∞–∑–º–µ—Ä –≤–∞—à–µ–≥–æ –Ω–æ–¥–∞ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö canvas
double requiredScaleFor10px = 10.0 / nodeDiameter;
(–ú—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —Ñ–æ—Ä–º—É–ª–∞ visualSize = nodeDiameter * currentScale)

–§–∏–Ω–∞–ª—å–Ω—ã–π maxScale: maxScale –¥–ª—è InteractiveViewer –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∏–∑ –¥–≤—É—Ö –∑–Ω–∞—á–µ–Ω–∏–π: —Ç–æ–≥–æ, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ö–æ—Ä–æ—à–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –∑—É–º–∞, –∏ —Ç–æ–≥–æ, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç 10px-–Ω–æ–¥—ã.

Dart

double finalMaxScale = max(maxScale, requiredScaleFor10px);
4. –°–æ–±–µ—Ä–∏—Ç–µ –≤—Å–µ –≤–º–µ—Å—Ç–µ
–¢–µ–ø–µ—Ä—å –æ–±—ä–µ–¥–∏–Ω–∏–º –≤—Å–µ —à–∞–≥–∏ –≤ –ª–æ–≥–∏–∫—É –≤–∞—à–µ–≥–æ –≤–∏–¥–∂–µ—Ç–∞.

Dart

// 1. –ó–∞–¥–∞–π—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
const double LEVEL2_THRESHOLD = 4.0;
const double LEVEL3_THRESHOLD = 12.0;
const double MAX_RELATIVE_ZOOM = 25.0;
const double NODE_DIAMETER = 2.0; // –ü—Ä–∏–º–µ—Ä "—Ä–µ–∞–ª—å–Ω–æ–≥–æ" —Ä–∞–∑–º–µ—Ä–∞ –Ω–æ–¥–∞

// 2. –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è (–≤ –º–µ—Ç–æ–¥–µ build –∏–ª–∏ layout)
double timelineWidth = 10000.0; // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
double screenWidth = MediaQuery.of(context).size.width;

double minScale = screenWidth / timelineWidth;
double relativeMaxScale = minScale * MAX_RELATIVE_ZOOM;
double requiredScaleFor10px = 10.0 / NODE_DIAMETER;

double finalMaxScale = max(relativeMaxScale, requiredScaleFor10px);

// 3. –°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ InteractiveViewer
InteractiveViewer(
  transformationController: _controller,
  minScale: minScale,
  maxScale: finalMaxScale,
  // ... –≤–∞—à –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
)

// 4. –í —Å–ª—É—à–∞—Ç–µ–ª–µ TransformationController –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
void _onScaleUpdate() {
  double currentScale = _controller.value.getMaxScaleOnAxis();
  double relativeZoom = currentScale / minScale;

  int newLevel;
  if (relativeZoom >= LEVEL3_THRESHOLD) {
    newLevel = 3;
  } else if (relativeZoom >= LEVEL2_THRESHOLD) {
    newLevel = 2;
  } else {
    newLevel = 1;
  }

  if (newLevel != _currentLevel) {
    setState(() {
      _currentLevel = newLevel;
      // –ó–¥–µ—Å—å –≤—ã –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ UI –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
    });
  }
}
–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?
–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –æ–ø—ã—Ç: –£—Ä–æ–≤–Ω–∏ –∑—É–º–∞ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–º—É —É–≤–µ–ª–∏—á–µ–Ω–∏—é. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ iPhone –∏ iPad –ø–µ—Ä–µ–π–¥–µ—Ç –Ω–∞ "—É—Ä–æ–≤–µ–Ω—å –º–µ—Å—è—Ü–µ–≤" –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç —Ç–∞–π–º–ª–∞–π–Ω –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑.

–ù–µ—Ç "–º–µ—Ä—Ç–≤–æ–≥–æ" –∑—É–º–∞: maxScale —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –±–æ–ª—å—à–µ minScale –Ω–∞ –∑–∞–¥–∞–Ω–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (MAX_RELATIVE_ZOOM), —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –∑—É–º–∞ –¥–∞–∂–µ –Ω–∞ –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö —Ç–∞–π–º–ª–∞–π–Ω–∞—Ö.

–ì–∞—Ä–∞–Ω—Ç–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ max() –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ —Å–º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏—á—å –Ω—É–∂–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–æ–¥ —Å—Ç–∞–ª 10px, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ, —á–µ–º MAX_RELATIVE_ZOOM.

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ —Ä–µ—à–∞–µ—Ç –≤—Å–µ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤–∞–º–∏ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Å–æ–∑–¥–∞–µ—Ç –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—É—é –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—É—é —Å–∏—Å—Ç–µ–º—É –∑—É–º–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –£–¥–∞—á–∏! üëç