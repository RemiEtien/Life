# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥)

## üéØ –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Ç—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –≥–∏–±–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

## üß† –§–∏–ª–æ—Å–æ—Ñ–∏—è –¥–∏–∑–∞–π–Ω–∞

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
1. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** ‚Äî —ç–º–æ—Ü–∏–∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è
2. **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äî –≤—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
3. **–ì—Ä–∞–¥–∞—Ü–∏—è** ‚Äî –æ—Ç –º–∏–Ω–∏–º–∞–ª–∏–∑–º–∞ –¥–æ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è
4. **Performance First** ‚Äî –∫—Ä–∞—Å–æ—Ç–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ —É–±–∏–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### "–í—ã—Ü–≤–µ—Ç—à–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è"
–í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –±–µ–∑ —ç–º–æ—Ü–∏–π –≤—ã–≥–ª—è–¥—è—Ç –∫–∞–∫ —Å—Ç–∞—Ä—ã–µ —á–µ—Ä–Ω–æ-–±–µ–ª—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:
- –°–µ—Ä—ã–π —Ü–≤–µ—Ç —Å opacity 0.3-0.4
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞—É—Ä—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- –ú–æ—Ç–∏–≤–∞—Ü–∏—è: –¥–æ–±–∞–≤–∏—Ç—å —Ü–≤–µ—Ç = "–ø—Ä–æ—è–≤–∏—Ç—å" –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ

## üìã –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

### –¢—Ä–∏ —É—Ä–æ–≤–Ω—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

#### 1. Timeline (Lifeline) ‚Äî –ú–∞–∫—Ä–æ-—É—Ä–æ–≤–µ–Ω—å
- **–ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –æ–∫—Ä–∞—Å–∫–∞ –ª–∏–Ω–∏–∏** ‚Äî —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ª–∞–Ω–¥—à–∞—Ñ—Ç –∂–∏–∑–Ω–∏
- **–ê—É—Ä–∞ –≤–æ–∫—Ä—É–∑ —É–∑–ª–æ–≤** ‚Äî —Å–≤–µ—á–µ–Ω–∏–µ –≤ —Ü–≤–µ—Ç–µ —ç–º–æ—Ü–∏–∏
- **–ü–æ–≥–æ–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã** (zoom > 3.0) ‚Äî —á–∞—Å—Ç–∏—Ü—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è

#### 2. Memory View Screen ‚Äî –ü–æ–ª–Ω–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ
- **–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Ñ–æ–Ω–∞** ‚Äî –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è
- **–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã** ‚Äî –¥–æ–∂–¥—å/—Å–Ω–µ–≥/–∏—Å–∫—Ä—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
- **–¶–≤–µ—Ç–æ–≤–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —Ñ–æ—Ç–æ** ‚Äî subtle color grading

#### 3. Emotional Timeline Export ‚Äî –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- –≠–∫—Å–ø–æ—Ä—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã (PNG/PDF)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —ç–º–æ—Ü–∏—è–º
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ (8 –±–∞–∑–æ–≤—ã—Ö —ç–º–æ—Ü–∏–π)

```dart
class EmotionColors {
  static const joy = HSLColor.fromAHSL(1.0, 48, 1.0, 0.5);      // ‚òÄÔ∏è –∂–µ–ª—Ç—ã–π
  static const sadness = HSLColor.fromAHSL(1.0, 208, 0.9, 0.6);  // üåßÔ∏è —Å–∏–Ω–∏–π
  static const anger = HSLColor.fromAHSL(1.0, 0, 0.8, 0.55);    // ‚õàÔ∏è –∫—Ä–∞—Å–Ω—ã–π
  static const fear = HSLColor.fromAHSL(1.0, 120, 0.4, 0.45);   // üå´Ô∏è –∑–µ–ª–µ–Ω—ã–π
  static const disgust = HSLColor.fromAHSL(1.0, 90, 0.6, 0.4);  // üçÇ –∑–µ–ª–µ–Ω–æ-–∂–µ–ª—Ç—ã–π
  static const surprise = HSLColor.fromAHSL(1.0, 30, 0.9, 0.6); // ‚ú® –æ—Ä–∞–Ω–∂–µ–≤—ã–π
  static const love = HSLColor.fromAHSL(1.0, 330, 0.8, 0.5);    // üå∏ —Ä–æ–∑–æ–≤—ã–π
  static const neutral = HSLColor.fromAHSL(1.0, 0, 0, 0.5);     // üòê —Å–µ—Ä—ã–π
}
```

## üé® –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–ø–æ–≥–æ–¥–Ω—ã–µ)

### –ü—Ä–∏ zoom in (> 3.0x):

| –≠–º–æ—Ü–∏—è | –ü–æ–≥–æ–¥–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç | Particle System |
|--------|----------------|-----------------|
| üòä Joy | ‚òÄÔ∏è –°–æ–ª–Ω–µ—á–Ω—ã–π –¥–µ–Ω—å | –ó–æ–ª–æ—Ç—ã–µ sparkles, light rays |
| ‚ù§Ô∏è Love | üå∏ –í–µ—Å–Ω–∞ | –†–æ–∑–æ–≤—ã–µ –ª–µ–ø–µ—Å—Ç–∫–∏, —Å–µ—Ä–¥–µ—á–∫–∏ |
| üòå Peace | ‚ùÑÔ∏è –õ–µ–≥–∫–∏–π —Å–Ω–µ–≥ | –°–Ω–µ–∂–∏–Ω–∫–∏, –º—è–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ |
| üò¢ Sadness | üåßÔ∏è –î–æ–∂–¥—å | –ö–∞–ø–ª–∏ –¥–æ–∂–¥—è, —Ç—É—á–∏ |
| üò° Anger | ‚õàÔ∏è –ì—Ä–æ–∑–∞ | –ú–æ–ª–Ω–∏–∏, –∫—Ä–∞—Å–Ω—ã–µ –∏—Å–∫—Ä—ã |
| üò® Fear | üå´Ô∏è –¢—É–º–∞–Ω | Fog, —Ç–µ–Ω–∏, distortion |
| ü§Æ Disgust | üçÇ –û—Å–µ–Ω—å | –ö–æ—Ä–∏—á–Ω–µ–≤—ã–µ –ª–∏—Å—Ç—å—è |
| üò≤ Surprise | ‚ú® –§–µ–π–µ—Ä–≤–µ—Ä–∫ | –í—Å–ø—ã—à–∫–∏, –∑–≤–µ–∑–¥—ã |

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

```dart
// –î–æ–±–∞–≤–∏—Ç—å –≤ Memory –º–æ–¥–µ–ª—å (lib/memory.dart)
class Memory {
  // ... existing fields

  // –ù–û–í–´–ï –ü–û–õ–Ø –¥–ª—è —ç–º–æ—Ü–∏–π:
  String? primaryEmotion;    // 'joy' | 'sadness' | 'anger' | ... (nullable!)
  String? secondaryEmotion;  // –¥–ª—è —Å–º–µ—à–∞–Ω–Ω—ã—Ö —á—É–≤—Å—Ç–≤ (nullable!)
  double emotionIntensity = 0.5;  // 0.0 (—Å–ª–∞–±–æ) - 1.0 (—Å–∏–ª—å–Ω–æ)

  // –ú–ò–ì–†–ê–¶–ò–Ø: –æ—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  List<String> emotionsData = [];  // –±—É–¥–µ—Ç deprecated

  @ignore
  Map<String, int> get emotions {
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –≤ –Ω–æ–≤—ã–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —á—Ç–µ–Ω–∏–∏
    if (emotionsData.isNotEmpty && primaryEmotion == null) {
      _migrateFromOldFormat();
    }
    return {...};  // —Å—Ç–∞—Ä—ã–π –≥–µ—Ç—Ç–µ—Ä –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  }
}

enum EmotionType {
  joy,       // ‚òÄÔ∏è –†–∞–¥–æ—Å—Ç—å
  sadness,   // üåßÔ∏è –ì—Ä—É—Å—Ç—å
  anger,     // ‚õàÔ∏è –ì–Ω–µ–≤
  fear,      // üå´Ô∏è –°—Ç—Ä–∞—Ö
  disgust,   // üçÇ –û—Ç–≤—Ä–∞—â–µ–Ω–∏–µ
  surprise,  // ‚ú® –£–¥–∏–≤–ª–µ–Ω–∏–µ
  love,      // üå∏ –õ—é–±–æ–≤—å
  neutral,   // üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ
}
```

**–ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
```dart
void _migrateFromOldFormat() {
  if (emotionsData.isEmpty) return;

  final oldEmotions = emotions;  // Map<String, int>

  // –ë–µ—Ä–µ–º —ç–º–æ—Ü–∏—é —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å—é
  final sorted = oldEmotions.entries.toList()
    ..sort((a, b) => b.value.compareTo(a.value));

  if (sorted.isNotEmpty) {
    primaryEmotion = sorted.first.key;
    emotionIntensity = sorted.first.value / 100.0; // 0-100 ‚Üí 0.0-1.0
  }

  if (sorted.length > 1) {
    secondaryEmotion = sorted[1].key;
  }
}
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (UserProfile)

```dart
// –í lib/models/user_profile.dart –¥–æ–±–∞–≤–∏—Ç—å:
class UserProfile {
  // ... existing fields

  // === EMOTION VISUALIZATION SETTINGS ===

  // Timeline (Lifeline) Settings
  bool enableEmotionalGradient = true;      // –ì—Ä–∞–¥–∏–µ–Ω—Ç –Ω–∞ –ª–∏–Ω–∏–∏ (DEFAULT: ON)
  bool enableNodeAura = true;               // –ê—É—Ä–∞ –≤–æ–∫—Ä—É–∑ —É–∑–ª–æ–≤ (DEFAULT: ON)
  bool enableWeatherEffects = false;        // –ü–æ–≥–æ–¥–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã (DEFAULT: OFF)

  // Memory View Screen Settings
  bool enableMemoryViewGradient = true;     // –§–æ–Ω —ç–∫—Ä–∞–Ω–∞ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è (DEFAULT: ON)
  bool enableMemoryViewParticles = false;   // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã (DEFAULT: OFF)
  bool enablePhotoColorGrading = false;     // –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —Ñ–æ—Ç–æ (DEFAULT: OFF)

  // Performance
  bool enableHighQualityEffects = true;     // –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (DEFAULT: ON)
}
```

**–õ–æ–≥–∏–∫–∞ –¥–ª—è —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:**
```dart
// –í device_performance_detector.dart:
if (DevicePerformanceDetector.performance == DevicePerformance.low) {
  userProfile.enableWeatherEffects = false;
  userProfile.enableMemoryViewParticles = false;
  userProfile.enableHighQualityEffects = false;
}
```

### 3. UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —ç–º–æ—Ü–∏–π

**–ó–ê–ú–ï–ù–ê —Ç–µ–∫—É—â–µ–≥–æ UI –≤ memory_edit_screen.dart:**

–í–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö ChoiceChip (—Å—Ç—Ä–æ–∫–∏ 1547-1583):
```dart
// –ù–û–í–´–ô UI: –ö—Ä—É–≥–æ–≤–æ–π –ø–∏–∫–µ—Ä + —Å–ª–∞–π–¥–µ—Ä
Widget _buildEmotionSection() {
  return Column(
    crossAxisAlignment: CrossAxisAlignment.start,
    children: [
      Text('üé® –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–∫—Ä–∞—Å–∫–∞', style: TextStyle(fontSize: 16)),
      SizedBox(height: 8),

      // –ï—Å–ª–∏ —ç–º–æ—Ü–∏—è –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ—Ç–∏–≤–∞—Ü–∏—é
      if (_primaryEmotion == null)
        _buildEmotionPrompt()
      else
        _buildSelectedEmotionView(),

      SizedBox(height: 12),

      // –ö—Ä—É–≥–æ–≤–æ–π –ø–∏–∫–µ—Ä (8 –∏–∫–æ–Ω–æ–∫)
      _buildCircularEmotionPicker(),
    ],
  );
}

Widget _buildEmotionPrompt() {
  return Container(
    padding: EdgeInsets.all(12),
    decoration: BoxDecoration(
      color: Colors.grey.shade800.withOpacity(0.3),
      borderRadius: BorderRadius.circular(8),
    ),
    child: Row(
      children: [
        Icon(Icons.lightbulb_outline, color: Colors.yellow.shade700),
        SizedBox(width: 12),
        Expanded(
          child: Text(
            '–î–æ–±–∞–≤—å—Ç–µ —ç–º–æ—Ü–∏—é, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ —Ü–≤–µ—Ç–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–Ω–æ–π –ª–∏–Ω–∏–∏!',
            style: TextStyle(color: Colors.white70, fontSize: 13),
          ),
        ),
      ],
    ),
  );
}

Widget _buildSelectedEmotionView() {
  return Container(
    padding: EdgeInsets.all(12),
    decoration: BoxDecoration(
      color: _getEmotionColor(_primaryEmotion!).withOpacity(0.2),
      borderRadius: BorderRadius.circular(8),
    ),
    child: Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Row(
          children: [
            Text(
              '${_getEmotionIcon(_primaryEmotion!)} ${_getEmotionName(_primaryEmotion!)}',
              style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
            ),
            Spacer(),
            IconButton(
              icon: Icon(Icons.clear, size: 20),
              onPressed: () => setState(() {
                _primaryEmotion = null;
                _secondaryEmotion = null;
              }),
            ),
          ],
        ),

        // –í—Ç–æ—Ä–∏—á–Ω–∞—è —ç–º–æ—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        if (_secondaryEmotion != null)
          Padding(
            padding: EdgeInsets.only(top: 8),
            child: Row(
              children: [
                Text('+ ${_getEmotionIcon(_secondaryEmotion!)} ${_getEmotionName(_secondaryEmotion!)}'),
                Spacer(),
                IconButton(
                  icon: Icon(Icons.clear, size: 18),
                  onPressed: () => setState(() => _secondaryEmotion = null),
                ),
              ],
            ),
          )
        else
          TextButton.icon(
            onPressed: _showSecondaryEmotionPicker,
            icon: Icon(Icons.add, size: 16),
            label: Text('–î–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä—É—é —ç–º–æ—Ü–∏—é'),
          ),

        SizedBox(height: 12),

        // –°–ª–∞–π–¥–µ—Ä –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
        Text('–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å: ${(_emotionIntensity * 100).round()}%'),
        Slider(
          value: _emotionIntensity,
          min: 0.0,
          max: 1.0,
          divisions: 10,
          onChanged: (value) => setState(() => _emotionIntensity = value),
        ),
      ],
    ),
  );
}

Widget _buildCircularEmotionPicker() {
  final emotions = ['joy', 'love', 'surprise', 'pride', 'sadness', 'anger', 'fear', 'disgust'];

  return Wrap(
    spacing: 8,
    runSpacing: 8,
    children: emotions.map((emotion) {
      final isSelected = _primaryEmotion == emotion;
      return GestureDetector(
        onTap: () => setState(() {
          _primaryEmotion = emotion;
          _emotionIntensity = 0.5; // default
        }),
        child: Container(
          width: 60,
          height: 60,
          decoration: BoxDecoration(
            color: isSelected
                ? _getEmotionColor(emotion).withOpacity(0.3)
                : Colors.grey.shade800.withOpacity(0.3),
            borderRadius: BorderRadius.circular(30),
            border: isSelected
                ? Border.all(color: _getEmotionColor(emotion), width: 2)
                : null,
          ),
          child: Center(
            child: Text(
              _getEmotionIcon(emotion),
              style: TextStyle(fontSize: 28),
            ),
          ),
        ),
      );
    }).toList(),
  );
}

// –•–µ–ª–ø–µ—Ä—ã
String _getEmotionIcon(String emotion) {
  switch (emotion) {
    case 'joy': return '‚òÄÔ∏è';
    case 'sadness': return 'üåßÔ∏è';
    case 'anger': return '‚ö°';
    case 'fear': return 'üå´Ô∏è';
    case 'disgust': return 'üçÇ';
    case 'surprise': return '‚ú®';
    case 'love': return '‚ù§Ô∏è';
    case 'pride': return 'üèÜ';
    default: return 'üòê';
  }
}

Color _getEmotionColor(String emotion) {
  switch (emotion) {
    case 'joy': return Colors.yellow.shade700;
    case 'sadness': return Colors.blue.shade600;
    case 'anger': return Colors.red.shade700;
    case 'fear': return Colors.green.shade700;
    case 'disgust': return Colors.lime.shade700;
    case 'surprise': return Colors.orange.shade700;
    case 'love': return Colors.pink.shade400;
    case 'pride': return Colors.purple.shade400;
    default: return Colors.grey;
  }
}
```

### 3. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ timeline

#### –ú–∞–∫—Ä–æ-—É—Ä–æ–≤–µ–Ω—å (zoom < 0.5)
```dart
// lifeline_painter.dart - _drawArterySystem
void _drawEmotionalGradient(Canvas canvas, Path path, List<Memory> memories) {
  // –°–æ–∑–¥–∞—Ç—å gradient shader –∏–∑ —ç–º–æ—Ü–∏–π –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π
  List<Color> colors = [];
  List<double> stops = [];

  for (int i = 0; i < memories.length; i++) {
    final memory = memories[i];
    final emotionColor = EmotionColors.getColor(memory.primaryEmotion);
    colors.add(emotionColor);
    stops.add(i / (memories.length - 1));
  }

  final gradient = ui.Gradient.linear(
    startPoint,
    endPoint,
    colors,
    stops,
  );

  final paint = Paint()
    ..shader = gradient
    ..style = PaintingStyle.stroke
    ..strokeWidth = calculateWidth(memory.emotionIntensity);
}
```

#### –ú–∏–∫—Ä–æ-—É—Ä–æ–≤–µ–Ω—å (zoom > 1.5)
```dart
// –ê—É—Ä–∞ –≤–æ–∫—Ä—É–≥ —É–∑–ª–∞
void _drawEmotionalAura(Canvas canvas, Offset position, Memory memory) {
  final emotionColor = EmotionColors.getColor(memory.primaryEmotion);
  final intensity = memory.emotionIntensity;

  final auraPaint = Paint()
    ..color = emotionColor.withOpacity(0.3 * intensity)
    ..maskFilter = MaskFilter.blur(
      BlurStyle.normal,
      20.0 * intensity,
    );

  canvas.drawCircle(position, 40 * intensity, auraPaint);
}
```

#### –ü–æ–≥–æ–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (zoom > 3.0)
```dart
// Particle system –¥–ª—è –∫–∞–∂–¥–æ–π —ç–º–æ—Ü–∏–∏
class EmotionParticleEffect {
  final EmotionType emotion;
  final List<Particle> particles = [];

  void update(double deltaTime) {
    // Update –≤—Å–µ —á–∞—Å—Ç–∏—Ü—ã
    // Spawn –Ω–æ–≤—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç intensity
  }

  void paint(Canvas canvas) {
    for (var particle in particles) {
      particle.paint(canvas);
    }
  }
}
```

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ—ç—Ç–∞–ø–Ω—ã–π)

### üéØ –°–ï–ì–û–î–ù–Ø: Rapid Prototyping (4-6 —á–∞—Å–æ–≤)

**–¶–µ–ª—å**: –ü—Ä–æ—Ç–æ—Ç–∏–ø –Ω–æ–≤–æ–≥–æ UI —ç–º–æ—Ü–∏–π + –±–∞–∑–æ–≤–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ timeline

#### –≠—Ç–∞–ø 1: –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (30 –º–∏–Ω)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `primaryEmotion`, `secondaryEmotion`, `emotionIntensity` –≤ Memory
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é `_migrateFromOldFormat()`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `copyWith()` –∏ `toJson()`/`fromJson()`

#### –≠—Ç–∞–ø 2: –ù–æ–≤—ã–π UI —ç–º–æ—Ü–∏–π (2 —á–∞—Å–∞)
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `_buildEmotionChips()` –Ω–∞ `_buildEmotionSection()`
- [ ] –ö—Ä—É–≥–æ–≤–æ–π –ø–∏–∫–µ—Ä (8 –∫–Ω–æ–ø–æ–∫ —Å –∏–∫–æ–Ω–∫–∞–º–∏)
- [ ] –°–ª–∞–π–¥–µ—Ä –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ 0.0-1.0
- [ ] –ü—Ä–æ–º–ø—Ç "–î–æ–±–∞–≤—å—Ç–µ —ç–º–æ—Ü–∏—é..." –¥–ª—è –ø—É—Å—Ç—ã—Ö –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ç–æ—Ä–∏—á–Ω–æ–π —ç–º–æ—Ü–∏–∏

#### –≠—Ç–∞–ø 3: –ë–∞–∑–æ–≤–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Timeline (1.5 —á–∞—Å–∞)
- [ ] "–í—ã—Ü–≤–µ—Ç—à–∏–µ" –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è (—Å–µ—Ä—ã–π —Å opacity 0.3) –µ—Å–ª–∏ primaryEmotion == null
- [ ] –¶–≤–µ—Ç–Ω—ã–µ —É–∑–ª—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ primaryEmotion
- [ ] –ü—Ä–æ—Å—Ç–∞—è –∞—É—Ä–∞ (MaskFilter.blur) –≤–æ–∫—Ä—É–≥ —É–∑–ª–æ–≤

#### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1 —á–∞—Å)
- [ ] –°–æ–∑–¥–∞—Ç—å 5-10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å —Ä–∞–∑–Ω—ã–º–∏ —ç–º–æ—Ü–∏—è–º–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ Timeline
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å—Ç–∞—Ä—ã—Ö –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firestore

---

### Phase 2: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (–Ω–µ–¥–µ–ª—è 1-2)
- [ ] –ì—Ä–∞–¥–∏–µ–Ω—Ç –ª–∏–Ω–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç–º–æ—Ü–∏–π
- [ ] –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –º–µ–∂–¥—É –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏
- [ ] LOD –¥–ª—è performance
- [ ] Memory View Screen: —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω

### Phase 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–µ–¥–µ–ª—è 2)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ UserProfile
- [ ] UI –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ ProfileScreen
- [ ] –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [ ] Onboarding: –≤—ã–±–æ—Ä —Å—Ç–∏–ª—è

### Phase 4: –ü–æ–≥–æ–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–Ω–µ–¥–µ–ª—è 3-4) ‚Äî PREMIUM
- [ ] Particle system architecture
- [ ] Joy particles (sparkles)
- [ ] Sadness particles (rain)
- [ ] Anger particles (lightning)
- [ ] –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- [ ] Performance optimization (pooling, culling)

### Phase 5: Memory View Transform (–Ω–µ–¥–µ–ª—è 4-5) ‚Äî PREMIUM
- [ ] –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Ñ–æ–Ω–∞
- [ ] –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
- [ ] Color grading –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è

### Phase 6: Testing & Documentation (–Ω–µ–¥–µ–ª—è 5-6)

#### Unit Tests
- [ ] `memory_test.dart`: –¢–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
  - `test_primaryEmotion_nullable()`
  - `test_emotionIntensity_range()`
  - `test_migrateFromOldFormat()` ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö —ç–º–æ—Ü–∏–π
  - `test_toJson_fromJson_with_emotions()`
- [ ] `emotion_helpers_test.dart`: –¢–µ—Å—Ç—ã –¥–ª—è —Ü–≤–µ—Ç–æ–≤ –∏ –∏–∫–æ–Ω–æ–∫
  - `test_getEmotionColor()` –¥–ª—è –≤—Å–µ—Ö 8 —ç–º–æ—Ü–∏–π
  - `test_getEmotionIcon()` –¥–ª—è –≤—Å–µ—Ö 8 —ç–º–æ—Ü–∏–π
  - `test_blendEmotionColors()` –¥–ª—è –≤—Ç–æ—Ä–∏—á–Ω–æ–π —ç–º–æ—Ü–∏–∏

#### Integration Tests
- [ ] `emotion_visualization_test.dart`
  - –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å —ç–º–æ—Ü–∏–µ–π
  - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —ç–º–æ—Ü–∏–∏
  - –£–¥–∞–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–∏
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ Timeline
- [ ] `emotion_migration_test.dart`
  - –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —ç–º–æ—Ü–∏—è–º–∏
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
  - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

#### Documentation
- [ ] **README_EMOTIONS.md**: –û–±—â–∏–π –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã
  - –§–∏–ª–æ—Å–æ—Ñ–∏—è –¥–∏–∑–∞–π–Ω–∞
  - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (3 —É—Ä–æ–≤–Ω—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏)
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] **EMOTION_API.md**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
  - Memory –º–æ–¥–µ–ª—å (–Ω–æ–≤—ã–µ –ø–æ–ª—è)
  - EmotionHelper –∫–ª–∞—Å—Å (—É—Ç–∏–ª–∏—Ç—ã)
  - –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —ç–º–æ—Ü–∏—é
- [ ] **USER_GUIDE_EMOTIONS.md**: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —ç–º–æ—Ü–∏—é
  - –ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —Ü–≤–µ—Ç–∞
  - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–≥–æ–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

### Phase 7: Analytics & Export (–Ω–µ–¥–µ–ª—è 6-7)
- [ ] –≠–∫—Å–ø–æ—Ä—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã (PNG/PDF)
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —ç–º–æ—Ü–∏—è–º –≤ ProfileScreen
- [ ] AI insights: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Gemini)
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –≤ Premium

## ‚ö†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –ú–Ω–æ–≥–æ —á–∞—Å—Ç–∏—Ü = –ª–∞–≥–∏
   - –†–µ—à–µ–Ω–∏–µ: LOD, particle pooling, culling

2. **–î–Ω–µ–≤–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã**
   - –ú–Ω–æ–≥–æ —ç–º–æ—Ü–∏–π –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ
   - –†–µ—à–µ–Ω–∏–µ: –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∞—è —ç–º–æ—Ü–∏—è

3. **–í–∏–∑—É–∞–ª—å–Ω—ã–π —à—É–º**
   - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
   - –†–µ—à–µ–Ω–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É–∑–ª–∞

## üí∞ –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è

**FREE:**
- –ë–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ –∏ –∞—É—Ä–∞
- –ü—Ä–æ—Å—Ç—ã–µ —á–∞—Å—Ç–∏—Ü—ã (10-15 –º–∞–∫—Å)

**PREMIUM ($3.99/month):**
- –ü–æ–ª–Ω—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- –ë–æ–ª—å—à–µ —á–∞—Å—Ç–∏—Ü (50+)
- Sound effects
- Custom emotion themes

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- Timeline –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É–≤–∏–¥–µ—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã —ç–º–æ—Ü–∏–π
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å > 30 FPS –Ω–∞ medium devices
- Premium conversion rate > 5%

---

## üéØ MVP –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –¥–ª—è A/B —Ç–µ—Å—Ç–∞:
1. ‚úÖ 8 –±–∞–∑–æ–≤—ã—Ö —ç–º–æ—Ü–∏–π + intensity
2. ‚úÖ –¶–≤–µ—Ç–æ–≤–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –Ω–∞ –ª–∏–Ω–∏–∏
3. ‚úÖ –ê—É—Ä–∞ –≤–æ–∫—Ä—É–≥ —É–∑–ª–æ–≤
4. ‚ùå –ü–æ–≥–æ–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (post-launch premium)

–ï—Å–ª–∏ MVP –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç engagement - –¥–æ–±–∞–≤–ª—è–µ–º particle effects.
